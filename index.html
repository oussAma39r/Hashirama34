<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة المجمدات</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1, h2 {
            color: #333;
        }
        .section {
            background-color: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: none; /* إخفاء الأقسام افتراضياً */
        }
        .active-section {
            display: block; /* عرض القسم النشط */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        .delete-btn {
            background-color: #ff4444;
        }
        .delete-btn:hover {
            background-color: #cc0000;
        }
        select, input {
            padding: 5px;
            margin: 5px;
        }
        .input-group {
            margin-bottom: 10px;
        }
        #menu {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>نظام إدارة المجمدات</h1>

    <!-- قائمة الأزرار للدخول إلى كل قسم -->
    <div id="menu">
        <button onclick="showSection('search')">بحث عن المجمد</button>
        <button onclick="showSection('issues')">مشاكل المجمدات</button>
        <button onclick="showSection('foam')">حساب وزن الرغوة</button>
        <button onclick="showSection('defectives')">المنتجات التالفة للمجمدات</button>
        <button onclick="showSection('sinks')">الأحواض التالفة</button>
        <button onclick="showSection('moussage')">المنتجات التالفة Moussage</button>
        <button onclick="showSection('structure')">المنتجات التالفة من الهيكل</button>
        <button onclick="showSection('plastic')">الإطار البلاستيكي</button>
    </div>

    <!-- القسم 1: بحث عن المجمد -->
    <div class="section" id="search">
        <h2>بحث عن المجمد</h2>
        <div class="input-group">
            <label for="inputCode">أدخل كود العائلة (FH أو CFH) أو كود EAN6:</label>
            <input type="text" id="inputCode">
            <button onclick="searchFreezer()">بحث</button>
        </div>
        <div id="familyInfo"></div>
        <div id="searchResult"></div>
    </div>

    <!-- القسم 2: مشاكل المجمدات -->
    <div class="section" id="issues">
        <h2>مشاكل المجمدات</h2>
        <div class="input-group">
            <label for="issueFreezer">نموذج المجمد:</label>
            <select id="issueFreezer">
                <option value="">اختر المجمد</option>
                <!-- يتم ملؤها ديناميكياً -->
            </select>
            <label for="issueDate">التاريخ:</label>
            <input type="date" id="issueDate">
            <label for="issueTime">الوقت:</label>
            <input type="time" id="issueTime">
            <label for="issueDescription">وصف المشكلة:</label>
            <input type="text" id="issueDescription">
            <button onclick="addIssue()">إضافة مشكلة</button>
        </div>
        <table id="issuesTable">
            <thead>
                <tr>
                    <th>نموذج المجمد</th>
                    <th>التاريخ</th>
                    <th>الوقت</th>
                    <th>وصف المشكلة</th>
                    <th>إجراء</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- القسم 3: حساب وزن الرغوة -->
    <div class="section" id="foam">
        <h2>حساب وزن الرغوة</h2>
        <p>أدخل وزن القطع (5 للجسم، 3 للباب) ووزنها تحت الماء للحساب التلقائي.</p>
        <div class="input-group">
            <label>للجسم (5 قطع):</label>
            <div id="bodySamples">
                <!-- يتم إضافة حقول ديناميكياً -->
            </div>
            <label>للباب (3 قطع):</label>
            <div id="doorSamples">
                <!-- يتم إضافة حقول ديناميكياً -->
            </div>
            <button onclick="calculateFoamWeight()">حساب</button>
        </div>
        <div id="foamResult"></div>
    </div>

    <!-- القسم 4: المنتجات التالفة للمجمدات -->
    <div class="section" id="defectives">
        <h2>المنتجات التالفة للمجمدات</h2>
        <div class="input-group">
            <label for="defectiveFreezer">نموذج المجمد:</label>
            <select id="defectiveFreezer">
                <option value="">اختر المجمد</option>
                <!-- يتم ملؤها ديناميكياً -->
            </select>
            <label for="defectiveDate">التاريخ:</label>
            <input type="date" id="defectiveDate">
            <label for="defectiveTime">الوقت:</label>
            <input type="time" id="defectiveTime">
            <label for="defectiveDescription">وصف التلف:</label>
            <input type="text" id="defectiveDescription">
            <button onclick="addDefective()">إضافة تلف</button>
        </div>
        <table id="defectivesTable">
            <thead>
                <tr>
                    <th>نموذج المجمد</th>
                    <th>التاريخ</th>
                    <th>الوقت</th>
                    <th>وصف التلف</th>
                    <th>إجراء</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- القسم 5: الأحواض التالفة -->
    <div class="section" id="sinks">
        <h2>الأحواض التالفة</h2>
        <div class="input-group">
            <label for="sinkModel">نموذج المجمد:</label>
            <select id="sinkModel">
                <option value="">اختر النموذج</option>
                <option value="T13">T13</option>
                <option value="T19">T19</option>
                <option value="T260">T260</option>
                <option value="T280">T280</option>
                <option value="T380">T380</option>
                <option value="T390">T390</option>
                <option value="T450">T450</option>
            </select>
            <label for="sinkCount">عدد الأحواض:</label>
            <input type="number" id="sinkCount">
            <label for="capillaireCount">عدد Capillaire:</label>
            <input type="number" id="capillaireCount">
            <label for="leadCount">عدد الرصاص:</label>
            <input type="number" id="leadCount">
            <label for="blackBoardCount">عدد Black Board:</label>
            <input type="number" id="blackBoardCount">
            <label for="sidePanelGrand">Side Panel Grand:</label>
            <input type="number" id="sidePanelGrand">
            <label for="sidePanelPetit">Side Panel Petit:</label>
            <input type="number" id="sidePanelPetit">
            <label for="bottomBoard">Bottom Board:</label>
            <input type="number" id="bottomBoard">
            <label for="damageType">نوع التلف:</label>
            <select id="damageType">
                <option value="مادة أولية">مادة أولية</option>
                <option value="بعد الاستخدام اليدوي">بعد الاستخدام اليدوي</option>
                <option value="بعد الاستخدام الآلي">بعد الاستخدام الآلي</option>
            </select>
            <label for="evaporateurWeight">وزن Évaporateur:</label>
            <input type="text" id="evaporateurWeight" readonly>
            <button onclick="addSinkDamage()">إضافة</button>
        </div>
        <table id="sinksTable">
            <thead>
                <tr>
                    <th>نموذج</th>
                    <th>عدد الأحواض</th>
                    <th>عدد Capillaire</th>
                    <th>عدد الرصاص</th>
                    <th>عدد Black Board</th>
                    <th>Side Panel Grand</th>
                    <th>Side Panel Petit</th>
                    <th>Bottom Board</th>
                    <th>نوع التلف</th>
                    <th>وزن Évaporateur</th>
                    <th>إجراء</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- القسم 6: المنتجات التالفة Moussage -->
    <div class="section" id="moussage">
        <h2>المنتجات التالفة Moussage</h2>
        <div class="input-group">
            <label for="moussageFreezer">نموذج المجمد:</label>
            <select id="moussageFreezer">
                <option value="">اختر المجمد</option>
                <!-- يتم ملؤها ديناميكياً -->
            </select>
            <label for="moussageType">نوع التلف:</label>
            <select id="moussageType">
                <option value="Corps mousse">Corps mousse</option>
                <option value="Porte moussie">Porte moussie</option>
                <option value="Panneau">Panneau</option>
                <option value="Contre porte">Contre porte</option>
            </select>
            <label for="moussageReason">السبب:</label>
            <select id="moussageReason">
                <option value="Pre assemblage">Pre assemblage</option>
                <option value="Defaut mould">Defaut mould</option>
                <option value="Test mould">Test mould</option>
                <option value="Test densite">Test densite</option>
                <option value="Other">Other</option>
            </select>
            <label for="moussageDate">التاريخ:</label>
            <input type="date" id="moussageDate">
            <label for="moussageCount">العدد:</label>
            <input type="number" id="moussageCount">
            <button onclick="addMoussageDamage()">إضافة</button>
        </div>
        <table id="moussageTable">
            <thead>
                <tr>
                    <th>نموذج المجمد</th>
                    <th>نوع التلف</th>
                    <th>السبب</th>
                    <th>التاريخ</th>
                    <th>العدد</th>
                    <th>إجراء</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- القسم 7: المنتجات التالفة من الهيكل -->
    <div class="section" id="structure">
        <h2>المنتجات التالفة من الهيكل</h2>
        <div class="input-group">
            <label for="structureSide">جهة التلف:</label>
            <select id="structureSide">
                <option value="الأمامي">الأمامي</option>
                <option value="الخلفي">الخلفي</option>
                <option value="اليمين">اليمين</option>
                <option value="اليسار">اليسار</option>
            </select>
            <label for="structureCount">العدد:</label>
            <input type="number" id="structureCount">
            <label for="structureReason">السبب:</label>
            <select id="structureReason">
                <option value="مادة أولية">مادة أولية</option>
                <option value="مشكل في التقطيع">مشكل في التقطيع</option>
                <option value="مشكل في النقل">مشكل في النقل</option>
                <option value="مشكل في القياسات">مشكل في القياسات</option>
                <option value="خدوش أو انبعاجات">خدوش أو انبعاجات</option>
                <option value="صدأ أو تآكل">صدأ أو تآكل</option>
                <option value="عيوب في اللحام">عيوب في اللحام</option>
                <option value="تشوهات هيكلية">تشوهات هيكلية</option>
            </select>
            <label for="structureDate">التاريخ:</label>
            <input type="date" id="structureDate">
            <button onclick="addStructureDamage()">إضافة</button>
        </div>
        <table id="structureTable">
            <thead>
                <tr>
                    <th>جهة التلف</th>
                    <th>العدد</th>
                    <th>السبب</th>
                    <th>التاريخ</th>
                    <th>إجراء</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- القسم 8: الإطار البلاستيكي -->
    <div class="section" id="plastic">
        <h2>الإطار البلاستيكي</h2>
        <table>
            <thead>
                <tr>
                    <th>النموذج</th>
                    <th>القياس الخارجي (مم)</th>
                    <th>القياس الداخلي (مم)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>T13</td>
                    <td>565</td>
                    <td>465</td>
                </tr>
                <tr>
                    <td>T19</td>
                    <td>729</td>
                    <td>605</td>
                </tr>
                <tr>
                    <td>T39</td>
                    <td>1115</td>
                    <td>960</td>
                </tr>
                <tr>
                    <td>T450</td>
                    <td>1425</td>
                    <td>1270</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // دالة لعرض قسم معين وإخفاء الآخرين
        function showSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(sec => sec.classList.remove('active-section'));
            document.getElementById(sectionId).classList.add('active-section');
        }

        // قاعدة البيانات للمجمدات (فقط عائلتي CFH و FH)
        const freezers = [
            { ean6: '043153', code: 'CFH140A' },
            { ean6: '039965', code: 'CFH-MT26' },
            { ean6: '048752', code: 'CFH-MT260V4G' },
            { ean6: '048813', code: 'CFH-MT260V4W' },
            { ean6: '044181', code: 'CFH-MT26G' },
            { ean6: '048516', code: 'CFH-T130V2G' },
            { ean6: '048271', code: 'CFH-T130V2W' },
            { ean6: '012357', code: 'CFH-T13GM03' },
            { ean6: '012364', code: 'CFH-T19GM04' },
            { ean6: '048561', code: 'CFH-T390V1G' },
            { ean6: '048592', code: 'CFH-T390V1W' },
            { ean6: '048509', code: 'CFH-T390V2G' },
            { ean6: '048288', code: 'CFH-T390V2W' },
            { ean6: '012371', code: 'CFH-T39GM05' },
            { ean6: '043115', code: 'CFH-T39GM05G' },
            { ean6: '048493', code: 'CFH-T450V2G' },
            { ean6: '048523', code: 'CFH-T450V2W' },
            { ean6: '025623', code: 'CFH-T45GM10' },
            { ean6: '049438', code: 'FH-CR280V1G' },
            { ean6: '049421', code: 'FH-CR280V1W' },
            { ean6: '049452', code: 'FH-CR280V3G' },
            { ean6: '049445', code: 'FH-CR280V3W' },
            { ean6: '044198', code: 'FH-CR380G' },
            { ean6: '049711', code: 'FH-CR380V2G' },
            { ean6: '048738', code: 'FH-CR380V2W' },
            { ean6: '039835', code: 'FH-CR380W' }
        ];

        // ملء القوائم المنسدلة بنماذج المجمدات
        function populateDropdowns() {
            const models = freezers.map(f => f.code);
            const dropdowns = ['issueFreezer', 'defectiveFreezer', 'moussageFreezer'];
            dropdowns.forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    models.forEach(model => {
                        const option = document.createElement('option');
                        option.value = model;
                        option.textContent = model;
                        select.appendChild(option);
                    });
                }
            });
        }

        populateDropdowns();

        // دالة البحث عن المجمد
        function searchFreezer() {
            const input = document.getElementById('inputCode').value.toUpperCase();
            const familyInfo = document.getElementById('familyInfo');
            const searchResult = document.getElementById('searchResult');
            familyInfo.innerHTML = '';
            searchResult.innerHTML = '';

            if (input === 'FH' || input === 'CFH') {
                let info = '';
                if (input === 'FH') {
                    info = `
                        <h3>إصدارات FH</h3>
                        <p>FH-CR280/380 V1: ترموستات ميكانيكي، كومبريسور سرعة ثابتة</p>
                        <p>FH-CR280/380 V2: ترموستات ميكانيكي، كومبريسور inverter</p>
                        <p>FH-CR280/380 V3: ترموستات إلكتروني، كومبريسور سرعة ثابتة</p>
                    `;
                } else if (input === 'CFH') {
                    info = `
                        <h3>إصدارات CFH</h3>
                        <p>CFH-390/450/130/260 V1: ترموستات ميكانيكي، كومبريسور سرعة ثابتة</p>
                        <p>CFH-390/450/130/260 V2: ترموستات إلكتروني، كومبريسور سرعة ثابتة</p>
                        <p>CFH-390/450/130/260 V3: ترموستات إلكتروني، كومبريسور inverter</p>
                        <p>CFH-390/450/130/260 V4: ترموستات ميكانيكي، كومبريسور inverter</p>
                    `;
                }
                familyInfo.innerHTML = info;
            } else {
                const found = freezers.find(f => f.ean6 === input);
                if (found) {
                    searchResult.innerHTML = `<p>الكود: ${found.code}</p>`;
                } else {
                    searchResult.innerHTML = '<p>هذا الكود غير صحيح</p>';
                }
            }
        }

        // إضافة مشكلة
        function addIssue() {
            const model = document.getElementById('issueFreezer').value;
            const date = document.getElementById('issueDate').value;
            const time = document.getElementById('issueTime').value;
            const desc = document.getElementById('issueDescription').value;
            if (model && date && time && desc) {
                const table = document.getElementById('issuesTable').getElementsByTagName('tbody')[0];
                const row = table.insertRow();
                row.insertCell(0).textContent = model;
                row.insertCell(1).textContent = date;
                row.insertCell(2).textContent = time;
                row.insertCell(3).textContent = desc;
                const actionCell = row.insertCell(4);
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'حذف';
                deleteBtn.classList.add('delete-btn');
                deleteBtn.onclick = () => row.remove();
                actionCell.appendChild(deleteBtn);
            }
        }

        // إضافة تلف للمنتجات التالفة
        function addDefective() {
            const model = document.getElementById('defectiveFreezer').value;
            const date = document.getElementById('defectiveDate').value;
            const time = document.getElementById('defectiveTime').value;
            const desc = document.getElementById('defectiveDescription').value;
            if (model && date && time && desc) {
                const table = document.getElementById('defectivesTable').getElementsByTagName('tbody')[0];
                const row = table.insertRow();
                row.insertCell(0).textContent = model;
                row.insertCell(1).textContent = date;
                row.insertCell(2).textContent = time;
                row.insertCell(3).textContent = desc;
                const actionCell = row.insertCell(4);
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'حذف';
                deleteBtn.classList.add('delete-btn');
                deleteBtn.onclick = () => row.remove();
                actionCell.appendChild(deleteBtn);
            }
        }

        // إنشاء حقول لعينات الرغوة
        function createSampleInputs() {
            const bodyDiv = document.getElementById('bodySamples');
            const doorDiv = document.getElementById('doorSamples');
            for (let i = 1; i <= 5; i++) {
                bodyDiv.innerHTML += `<label>قطعة ${i} وزن:</label><input type="number" class="bodyWeight" step="0.01"><label>تحت الماء:</label><input type="number" class="bodyWater" step="0.01"><br>`;
            }
            for (let i = 1; i <= 3; i++) {
                doorDiv.innerHTML += `<label>قطعة ${i} وزن:</label><input type="number" class="doorWeight" step="0.01"><label>تحت الماء:</label><input type="number" class="doorWater" step="0.01"><br>`;
            }
        }

        createSampleInputs();

        // حساب وزن الرغوة
        function calculateFoamWeight() {
            let bodyResults = [];
            const bodyWeights = document.querySelectorAll('.bodyWeight');
            const bodyWaters = document.querySelectorAll('.bodyWater');
            for (let i = 0; i < 5; i++) {
                const weight = parseFloat(bodyWeights[i].value);
                const water = parseFloat(bodyWaters[i].value);
                if (weight && water) {
                    let result = weight / water;
                    result = result.toFixed(6).replace(/^0+/, ''); // حذف الأصفار الأمامية
                    bodyResults.push(parseFloat(result) * 1000); // افتراضياً، ضرب في 1000 للحصول على قيم مثل 33.33
                }
            }
            const bodyAvg = bodyResults.reduce((a, b) => a + b, 0) / 5 || 0;

            let doorResults = [];
            const doorWeights = document.querySelectorAll('.doorWeight');
            const doorWaters = document.querySelectorAll('.doorWater');
            for (let i = 0; i < 3; i++) {
                const weight = parseFloat(doorWeights[i].value);
                const water = parseFloat(doorWaters[i].value);
                if (weight && water) {
                    let result = weight / water;
                    result = result.toFixed(6).replace(/^0+/, '');
                    doorResults.push(parseFloat(result) * 1000);
                }
            }
            const doorAvg = doorResults.reduce((a, b) => a + b, 0) / 3 || 0;

            document.getElementById('foamResult').innerHTML = `<p>متوسط الجسم: ${bodyAvg.toFixed(2)}</p><p>متوسط الباب: ${doorAvg.toFixed(2)}</p>`;
        }

        // أوزان Évaporateur حسب النموذج (بالغرام)
        const evaporateurWeights = {
            'T13': 770,
            'T19': 900,
            'T260': 900,
            'T280': 900,
            'T380': 1300,
            'T390': 1250,
            'T450': 1800
        };

        // إضافة تلف للأحواض
        function addSinkDamage() {
            const model = document.getElementById('sinkModel').value;
            const count = parseInt(document.getElementById('sinkCount').value) || 0;
            const capillaire = document.getElementById('capillaireCount').value;
            const lead = document.getElementById('leadCount').value;
            const blackBoard = document.getElementById('blackBoardCount').value;
            const grand = document.getElementById('sidePanelGrand').value;
            const petit = document.getElementById('sidePanelPetit').value;
            const bottom = document.getElementById('bottomBoard').value;
            const type = document.getElementById('damageType').value;
            let evapWeight = 0;
            if (type === 'بعد الاستخدام الآلي' && count > 0 && model in evaporateurWeights) {
                evapWeight = (evaporateurWeights[model] * count) / 1000; // تحويل إلى كجم
            }
            document.getElementById('evaporateurWeight').value = evapWeight.toFixed(2) + ' kg';

            if (model) {
                const table = document.getElementById('sinksTable').getElementsByTagName('tbody')[0];
                const row = table.insertRow();
                row.insertCell(0).textContent = model;
                row.insertCell(1).textContent = count;
                row.insertCell(2).textContent = capillaire;
                row.insertCell(3).textContent = lead;
                row.insertCell(4).textContent = blackBoard;
                row.insertCell(5).textContent = grand;
                row.insertCell(6).textContent = petit;
                row.insertCell(7).textContent = bottom;
                row.insertCell(8).textContent = type;
                row.insertCell(9).textContent = evapWeight.toFixed(2) + ' kg';
                const actionCell = row.insertCell(10);
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'حذف';
                deleteBtn.classList.add('delete-btn');
                deleteBtn.onclick = () => row.remove();
                actionCell.appendChild(deleteBtn);
            }
        }

        // إضافة تلف Moussage
        function addMoussageDamage() {
            const model = document.getElementById('moussageFreezer').value;
            const type = document.getElementById('moussageType').value;
            const reason = document.getElementById('moussageReason').value;
            const date = document.getElementById('moussageDate').value;
            const count = document.getElementById('moussageCount').value;
            if (model && type && reason && date && count) {
                const table = document.getElementById('moussageTable').getElementsByTagName('tbody')[0];
                const row = table.insertRow();
                row.insertCell(0).textContent = model;
                row.insertCell(1).textContent = type;
                row.insertCell(2).textContent = reason;
                row.insertCell(3).textContent = date;
                row.insertCell(4).textContent = count;
                const actionCell = row.insertCell(5);
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'حذف';
                deleteBtn.classList.add('delete-btn');
                deleteBtn.onclick = () => row.remove();
                actionCell.appendChild(deleteBtn);
            }
        }

        // إضافة تلف الهيكل
        function addStructureDamage() {
            const side = document.getElementById('structureSide').value;
            const count = document.getElementById('structureCount').value;
            const reason = document.getElementById('structureReason').value;
            const date = document.getElementById('structureDate').value;
            if (side && count && reason && date) {
                const table = document.getElementById('structureTable').getElementsByTagName('tbody')[0];
                const row = table.insertRow();
                row.insertCell(0).textContent = side;
                row.insertCell(1).textContent = count;
                row.insertCell(2).textContent = reason;
                row.insertCell(3).textContent = date;
                const actionCell = row.insertCell(4);
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'حذف';
                deleteBtn.classList.add('delete-btn');
                deleteBtn.onclick = () => row.remove();
                actionCell.appendChild(deleteBtn);
            }
        }
    </script>
</body>
</html>