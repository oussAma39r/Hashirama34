<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة المجمدات</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #0056b3;
            border-bottom: 2px solid #0056b3;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }
        .nav-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            flex-grow: 1;
        }
        .nav-button:hover {
            background-color: #0056b3;
        }
        .section {
            display: none;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            background-color: #fafafa;
        }
        .section.active {
            display: block;
        }
        input, select, button {
            padding: 10px;
            margin: 5px 0 15px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background-color: #28a745;
            color: white;
            cursor: pointer;
            border: none;
        }
        button:hover {
            background-color: #218838;
        }
        .delete-btn {
            background-color: #dc3545;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        th {
            background-color: #007bff;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .result, .output {
            margin-top: 15px;
            padding: 15px;
            background-color: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-weight: bold;
            font-size: 18px;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>نظام إدارة المجمدات</h1>

    <div class="nav-buttons">
        <button class="nav-button" onclick="showSection('search-freezer')">بحث عن مجمد</button>
        <button class="nav-button" onclick="showSection('freezer-problems')">مشاكل الفريزر</button>
        <button class="nav-button" onclick="showSection('foam-density')">حساب كثافة الرغوة</button>
        <button class="nav-button" onclick="showSection('moussage-defects')">المنتجات التالفة (Moussage)</button>
        <button class="nav-button" onclick="showSection('damaged-tubs')">الأحواض التالفة</button>
        <button class="nav-button" onclick="showSection('damaged-structure')">الهياكل المعدنية التالفة</button>
        <button class="nav-button" onclick="showSection('plastic-frame')">قياسات الإطار البلاستيكي</button>
    </div>

    <!-- Section 1: Chercher Congelateur -->
    <div id="search-freezer" class="section">
        <h2>1. بحث عن مجمد</h2>
        <div class="form-group">
            <label for="saisie">أدخل كود العائلة (FH أو CFH) أو مباشرة كود EAN6:</label>
            <input type="text" id="saisie" placeholder="مثال: CFH أو 048752">
            <button onclick="handleSaisie()">إدخال</button>
        </div>
        <div id="version-info" style="display:none;"></div>
        <div id="ean-search-area" style="display:none;">
            <label for="codeRecherche">أدخل الآن كود EAN6 للبحث:</label>
            <input type="text" id="codeRecherche" placeholder="كود EAN6 المكون من 6 أرقام">
            <button onclick="searchByEAN()">بحث</button>
        </div>
        <div id="search-result" class="result"></div>
    </div>

    <!-- Section 2: Freezer Problems -->
    <div id="freezer-problems" class="section">
        <h2>2. تسجيل مشاكل الفريزر</h2>
        <form id="problem-form" class="form-grid">
            <div class="form-group">
                <label for="problem-freezer-select">اسم الفريزر:</label>
                <select id="problem-freezer-select"></select>
            </div>
            <div class="form-group">
                <label for="problem-date">التاريخ:</label>
                <input type="date" id="problem-date" required>
            </div>
            <div class="form-group">
                <label for="problem-time">الوقت:</label>
                <input type="time" id="problem-time" required>
            </div>
        </form>
        <button onclick="addProblem()">إضافة إلى الجدول</button>
        <table id="problems-table">
            <thead>
                <tr>
                    <th>اسم الفريزر</th>
                    <th>التاريخ</th>
                    <th>الوقت</th>
                    <th>إجراء</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Section 3: Foam Density Calculation -->
    <div id="foam-density" class="section">
        <h2>3. حساب كثافة الرغوة</h2>
        <h3>رغوة الهيكل (5 قطع)</h3>
        <div id="body-foam-inputs" class="form-grid">
            <!-- Inputs will be generated by JS -->
        </div>
        <button onclick="calculateFoamDensity('body', 5)">حساب كثافة رغوة الهيكل</button>
        <div id="body-foam-result" class="output"></div>
        
        <hr style="margin: 30px 0;">

        <h3>رغوة الباب (3 قطع)</h3>
        <div id="door-foam-inputs" class="form-grid">
            <!-- Inputs will be generated by JS -->
        </div>
        <button onclick="calculateFoamDensity('door', 3)">حساب كثافة رغوة الباب</button>
        <div id="door-foam-result" class="output"></div>
    </div>

    <!-- Section 4: Moussage Defects -->
    <div id="moussage-defects" class="section">
        <h2>4. المنتجات التالفة (Moussage)</h2>
        <form id="moussage-form" class="form-grid">
            <div class="form-group">
                <label for="moussage-freezer-select">اسم الفريزر:</label>
                <select id="moussage-freezer-select"></select>
            </div>
            <div class="form-group">
                <label for="moussage-defect-type">نوع التلف:</label>
                <select id="moussage-defect-type">
                    <option value="Corps mousse">Corps mousse</option>
                    <option value="Porte moussie">Porte moussie</option>
                    <option value="Panneau">Panneau</option>
                    <option value="Contre porte">Contre porte</option>
                </select>
            </div>
            <div class="form-group">
                <label for="moussage-reason">السبب:</label>
                <select id="moussage-reason">
                    <option value="pre assemblage">pre assemblage</option>
                    <option value="Defaut mould">Defaut mould</option>
                    <option value="Test mould">Test mould</option>
                    <option value="Test densite">Test densite</option>
                    <option value="defout fournisseur">defout fournisseur</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="moussage-date">التاريخ:</label>
                <input type="date" id="moussage-date" required>
            </div>
            <div class="form-group">
                <label for="moussage-quantity">العدد:</label>
                <input type="number" id="moussage-quantity" min="1" value="1" required>
            </div>
        </form>
        <button onclick="addMoussageDefect()">إضافة إلى الجدول</button>
        <table id="moussage-table">
            <thead>
                <tr>
                    <th>اسم الفريزر</th>
                    <th>نوع التلف</th>
                    <th>السبب</th>
                    <th>التاريخ</th>
                    <th>العدد</th>
                    <th>إجراء</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Section 5: Damaged Tubs -->
    <div id="damaged-tubs" class="section">
        <h2>5. الأحواض التالفة</h2>
        <form id="tub-form" class="form-grid">
            <div class="form-group">
                <label for="tub-freezer-select">نوع الحوض (الفريزر):</label>
                <select id="tub-freezer-select">
                    <option value="T13">T13</option>
                    <option value="T19">T19</option>
                    <option value="T260">T260</option>
                    <option value="T280">T280</option>
                    <option value="T380">T380</option>
                    <option value="T390">T390</option>
                    <option value="T450">T450</option>
                </select>
            </div>
            <div class="form-group">
                <label for="tub-defect-type">نوع التلف:</label>
                <select id="tub-defect-type">
                    <option value="مادة أولية">مادة أولية</option>
                    <option value="بعد الاستخدام اليدوي">بعد الاستخدام اليدوي</option>
                    <option value="بعد الاستخدام الآلي">بعد الاستخدام الآلي</option>
                </select>
            </div>
            <div class="form-group">
                <label for="tub-quantity">عدد الأحواض:</label>
                <input type="number" id="tub-quantity" min="1" value="1">
            </div>
            <div class="form-group">
                <label for="tub-capillaire">عدد Capillaire:</label>
                <input type="number" id="tub-capillaire" min="0" value="0">
            </div>
            <div class="form-group">
                <label for="tub-plomb">عدد الرصاص:</label>
                <input type="number" id="tub-plomb" min="0" value="0">
            </div>
            <div class="form-group">
                <label for="tub-blackboard">عدد Black board:</label>
                <input type="number" id="tub-blackboard" min="0" value="0">
            </div>
            <div class="form-group">
                <label for="tub-side-grand">Side Panel Grand:</label>
                <input type="number" id="tub-side-grand" min="0" value="0">
            </div>
            <div class="form-group">
                <label for="tub-side-petit">Side Panel Petit:</label>
                <input type="number" id="tub-side-petit" min="0" value="0">
            </div>
            <div class="form-group">
                <label for="tub-bottom">Bottom Board:</label>
                <input type="number" id="tub-bottom" min="0" value="0">
            </div>
        </form>
        <button onclick="addDamagedTub()">إضافة وحساب الوزن</button>
        <table id="tubs-table">
            <thead>
                <tr>
                    <th>نوع الحوض</th>
                    <th>نوع التلف</th>
                    <th>العدد</th>
                    <th>إجمالي وزن المبخر (كجم)</th>
                    <th>إجراء</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Section 6: Damaged Structure -->
    <div id="damaged-structure" class="section">
        <h2>6. الهياكل المعدنية التالفة</h2>
        <form id="structure-form" class="form-grid">
            <div class="form-group">
                <label for="structure-freezer-select">اسم الفريزر:</label>
                <select id="structure-freezer-select"></select>
            </div>
            <div class="form-group">
                <label for="structure-side">جهة التلف:</label>
                <select id="structure-side">
                    <option value="الأمامي">الأمامي</option>
                    <option value="الخلفي">الخلفي</option>
                    <option value="اليمين">اليمين</option>
                    <option value="اليسار">اليسار</option>
                </select>
            </div>
            <div class="form-group">
                <label for="structure-reason">السبب:</label>
                <select id="structure-reason">
                    <option value="مادة أولية">مادة أولية</option>
                    <option value="مشكل في التقطيع">مشكل في التقطيع (Cutting)</option>
                    <option value="مشكل في الثني">مشكل في الثني (Bending)</option>
                    <option value="مشكل في اللحام">مشكل في اللحام (Welding)</option>
                    <option value="مشكل في النقل">مشكل في النقل (Handling)</option>
                    <option value="مشكل في القياسات">مشكل في القياسات (Dimension)</option>
                    <option value="خدوش أو انبعاجات">خدوش أو انبعاجات (Scratches/Dents)</option>
                    <option value="مشكلة في الطلاء">مشكلة في الطلاء (Painting)</option>
                    <option value="أخرى">أخرى</option>
                </select>
            </div>
            <div class="form-group">
                <label for="structure-date">التاريخ:</label>
                <input type="date" id="structure-date" required>
            </div>
            <div class="form-group">
                <label for="structure-quantity">العدد:</label>
                <input type="number" id="structure-quantity" min="1" value="1" required>
            </div>
        </form>
        <button onclick="addStructureDefect()">إضافة إلى الجدول</button>
        <table id="structure-table">
            <thead>
                <tr>
                    <th>اسم الفريزر</th>
                    <th>جهة التلف</th>
                    <th>السبب</th>
                    <th>التاريخ</th>
                    <th>العدد</th>
                    <th>إجراء</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Section 7: Plastic Frame Measurements -->
    <div id="plastic-frame" class="section">
        <h2>7. قياسات الإطار البلاستيكي</h2>
        <table id="frames-table">
            <thead>
                <tr>
                    <th>الموديل</th>
                    <th>القياس الخارجي (مم)</th>
                    <th>القياس الداخلي (مم)</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>T13</td><td>565</td><td>465</td></tr>
                <tr><td>T19</td><td>729</td><td>605</td></tr>
                <tr><td>T39</td><td>1115</td><td>960</td></tr>
                <tr><td>T450</td><td>1425</td><td>1270</td></tr>
            </tbody>
        </table>
    </div>

</div>

<script>
    // --- DATABASE ---
    const freezerList = [
        { EAN6: '043153', Code: 'CFH140A' },
        { EAN6: '039965', Code: 'CFH-MT26' },
        { EAN6: '048752', Code: 'CFH-MT260V4G' },
        { EAN6: '048813', Code: 'CFH-MT260V4W' },
        { EAN6: '044181', Code: 'CFH-MT26G' },
        { EAN6: '048516', Code: 'CFH-T130V2G' },
        { EAN6: '048271', Code: 'CFH-T130V2W' },
        { EAN6: '012357', Code: 'CFH-T13GM03' },
        { EAN6: '012364', Code: 'CFH-T19GM04' },
        { EAN6: '048561', Code: 'CFH-T390V1G' },
        { EAN6: '048592', Code: 'CFH-T390V1W' },
        { EAN6: '048509', Code: 'CFH-T390V2G' },
        { EAN6: '048288', Code: 'CFH-T390V2W' },
        { EAN6: '012371', Code: 'CFH-T39GM05' },
        { EAN6: '043115', Code: 'CFH-T39GM05G' },
        { EAN6: '048493', Code: 'CFH-T450V2G' },
        { EAN6: '048523', Code: 'CFH-T450V2W' },
        { EAN6: '025623', Code: 'CFH-T45GM10' },
        { EAN6: '049438', Code: 'FH-CR280V1G' },
        { EAN6: '049421', Code: 'FH-CR280V1W' },
        { EAN6: '049452', Code: 'FH-CR280V3G' },
        { EAN6: '049445', Code: 'FH-CR280V3W' },
        { EAN6: '044198', Code: 'FH-CR380G' },
        { EAN6: '049711', Code: 'FH-CR380V2G' },
        { EAN6: '048738', Code: 'FH-CR380V2W' },
        { EAN6: '039835', Code: 'FH-CR380W' }
    ];

    const evaporatorWeights = {
        T13: 0.770, T19: 0.900, T280: 0.900, T260: 0.900,
        T380: 1.30, T390: 1.25, T450: 1.80
    };

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        populateFreezerSelects();
        createFoamInputs('body', 5);
        createFoamInputs('door', 3);
        showSection('search-freezer'); // Show first section by default
    });

    function populateFreezerSelects() {
        const selects = [
            document.getElementById('problem-freezer-select'),
            document.getElementById('moussage-freezer-select'),
            document.getElementById('structure-freezer-select')
        ];
        const uniqueCodes = [...new Set(freezerList.map(item => item.Code))].sort();
        
        selects.forEach(select => {
            if (select) {
                uniqueCodes.forEach(code => {
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = code;
                    select.appendChild(option);
                });
            }
        });
    }

    // --- NAVIGATION ---
    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });
        document.getElementById(sectionId).classList.add('active');
    }

    // --- SECTION 1: SEARCH FREEZER ---
    function handleSaisie() {
        const saisie = document.getElementById('saisie').value.trim().toUpperCase();
        const versionInfo = document.getElementById('version-info');
        const eanSearchArea = document.getElementById('ean-search-area');
        const searchResult = document.getElementById('search-result');
        
        versionInfo.style.display = 'none';
        eanSearchArea.style.display = 'none';
        versionInfo.innerHTML = '';
        searchResult.innerHTML = '';

        if (saisie === 'FH' || saisie === 'CFH') {
            let html = '<h3>========== Versions ==========</h3>';
            if (saisie === 'FH') {
                html += `<p><b>FH-CR280/380 V1:</b><br>Thermostat mécanique<br>Compresseur Vitesse constante</p>
                         <p><b>FH-CR280/380 V2:</b><br>Thermostat mécanique<br>Compresseur inverter</p>
                         <p><b>FH-CR280/380 V3:</b><br>Thermostat électronique<br>Compresseur Vitesse constante</p>`;
            } else { // CFH
                html += `<p><b>CFH-390/450/130/260 V1:</b><br>Thermostat mécanique<br>Compresseur Vitesse constante</p>
                         <p><b>CFH-390/450/130/260 V2:</b><br>Thermostat électronique<br>Compresseur Vitesse constante</p>
                         <p><b>CFH-390/450/130/260 V3:</b><br>Thermostat électronique<br>Compresseur inverter</p>
                         <p><b>CFH-390/450/130/260 V4:</b><br>Thermostat mécanique<br>Compresseur inventer</p>`;
            }
            html += '<h3>============================</h3>';
            versionInfo.innerHTML = html;
            versionInfo.style.display = 'block';
            eanSearchArea.style.display = 'block';
        } else {
            document.getElementById('codeRecherche').value = saisie;
            searchByEAN();
        }
    }

    function searchByEAN() {
        const codeRecherche = document.getElementById('codeRecherche').value.trim();
        const resultDiv = document.getElementById('search-result');
        const foundItem = freezerList.find(item => item.EAN6 === codeRecherche);

        if (foundItem) {
            resultDiv.textContent = `الرمز التجاري: ${foundItem.Code}`;
            resultDiv.style.color = 'green';
        } else {
            resultDiv.textContent = 'هذا الكود خاطئ';
            resultDiv.style.color = 'red';
        }
    }

    // --- DYNAMIC TABLE & FORM LOGIC ---
    function addRowToTable(tableId, data) {
        const tableBody = document.querySelector(`#${tableId} tbody`);
        const row = tableBody.insertRow();
        data.forEach(text => {
            const cell = row.insertCell();
            cell.textContent = text;
        });
        const actionCell = row.insertCell();
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'حذف';
        deleteBtn.className = 'delete-btn';
        deleteBtn.onclick = function() {
            row.remove();
        };
        actionCell.appendChild(deleteBtn);
    }

    // --- SECTION 2: FREEZER PROBLEMS ---
    function addProblem() {
        const freezer = document.getElementById('problem-freezer-select').value;
        const date = document.getElementById('problem-date').value;
        const time = document.getElementById('problem-time').value;
        if (!date || !time) {
            alert('يرجى إدخال التاريخ والوقت.');
            return;
        }
        addRowToTable('problems-table', [freezer, date, time]);
    }

    // --- SECTION 3: FOAM DENSITY ---
    function createFoamInputs(type, count) {
        const container = document.getElementById(`${type}-foam-inputs`);
        for (let i = 1; i <= count; i++) {
            const group = document.createElement('div');
            group.className = 'form-group';
            group.innerHTML = `
                <label>القطعة ${i} (غرام)</label>
                <input type="number" id="${type}-weight-${i}" placeholder="الوزن الجاف">
                <input type="number" id="${type}-pressure-${i}" placeholder="الوزن تحت الضغط">
            `;
            container.appendChild(group);
        }
    }

    function calculateFoamDensity(type, count) {
        let totalDensity = 0;
        let validPieces = 0;
        for (let i = 1; i <= count; i++) {
            const weight = parseFloat(document.getElementById(`${type}-weight-${i}`).value);
            const pressure = parseFloat(document.getElementById(`${type}-pressure-${i}`).value);
            if (!isNaN(weight) && !isNaN(pressure) && weight > 0) {
                const density = (pressure / weight) / 1000; // 270/9 = 30 -> 0.03
                if (density > 0) {
                    totalDensity += (weight / pressure);
                    validPieces++;
                }
            }
        }
        const resultDiv = document.getElementById(`${type}-foam-result`);
        if (validPieces > 0) {
            const averageGramsPerLiter = 1 / (totalDensity / validPieces);
            resultDiv.textContent = `متوسط الكثافة: ${averageGramsPerLiter.toFixed(2)} g/L`;
        } else {
            resultDiv.textContent = 'يرجى إدخال قيم صالحة.';
        }
    }

    // --- SECTION 4: MOUSSAGE DEFECTS ---
    function addMoussageDefect() {
        const data = [
            document.getElementById('moussage-freezer-select').value,
            document.getElementById('moussage-defect-type').value,
            document.getElementById('moussage-reason').value,
            document.getElementById('moussage-date').value,
            document.getElementById('moussage-quantity').value
        ];
        if (!data[3] || !data[4]) {
            alert('يرجى إدخال التاريخ والعدد.');
            return;
        }
        addRowToTable('moussage-table', data);
    }

    // --- SECTION 5: DAMAGED TUBS ---
    function addDamagedTub() {
        const tubType = document.getElementById('tub-freezer-select').value;
        const defectType = document.getElementById('tub-defect-type').value;
        const quantity = parseInt(document.getElementById('tub-quantity').value) || 0;
        
        let totalWeight = 0;
        if (defectType === 'بعد الاستخدام الآلي') {
            const weightPerUnit = evaporatorWeights[tubType] || 0;
            totalWeight = quantity * weightPerUnit;
        }
        
        const data = [tubType, defectType, quantity, totalWeight.toFixed(3)];
        addRowToTable('tubs-table', data);
    }

    // --- SECTION 6: DAMAGED STRUCTURE ---
    function addStructureDefect() {
        const data = [
            document.getElementById('structure-freezer-select').value,
            document.getElementById('structure-side').value,
            document.getElementById('structure-reason').value,
            document.getElementById('structure-date').value,
            document.getElementById('structure-quantity').value
        ];
        if (!data[3] || !data[4]) {
            alert('يرجى إدخال التاريخ والعدد.');
            return;
        }
        addRowToTable('structure-table', data);
    }

</script>

</body>
</html>
